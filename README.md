SFDC Contact Displayer 3000
============================

A very simple proof-of-concept project that authenticates with Salesforce via OAuth2 and then fetches a list of contacts.
## Salesforce Configuration
You must have System Administrator access to your Salesforce instance and make the following changes to your configuration to support OAuth and CORS:

#### OAuth
* General setup directions are available at: https://help.salesforce.com/articleView?id=connected_app_create.htm&type=0
* Go to Setup > Apps > App Manager and add a "New Connected App"
* Key Settings
    * **Enable OAuth Settings** must be checked
    * **Callback URL** should be set to the following path under whatever domain you are setting up the project at: ```/login/check-salesforce```
        * By default for docker this will be `````https://demo.ldev/login/check-salesforce`````
        * This ***MUST*** use the https:// protocol, as it is required by Salesforce.
    * In the picklist for **Selected Auth Scopes**, select the following:
        * Access and manage your data (api)
        * Access your basic information (id, profile...)        
* After saving, make a note of the Consumer Key and Consumer Secret that were generated by Salesforce for this App.
* Changes can take up to 10 minutes to be published on the Salesforce side.

More details are available here: https://developer.salesforce.com/docs/atlas.en-us.api_rest.meta/api_rest/quickstart_oauth.htm

#### CORS
Cross-origin resource sharing (CORS) must be enabled for your instance in order for AJAX requests from the web application to be permitted.
    
* Go to Setup > Security > CORS and hit "New"
* Add the domain at which you're setting up the app (by default this will be https://demo.ldev). 

#### Other Information
* Note your instance (e.g., NA25) at Setup > Company Settings > Company Information - you'll need it later!

## Installation
This package is optimized to be installed against a docker instance and includes a self-signed certificate.  

1. Check out the project wherever you like.
2. Copy `/app/config/parameters.yml.dist` to `/app/config/parameters.yml` and make changes to the Salesforce parameters using the data you recorded in the OAuth step above:
    * client_id is the "Consumer Key"
    * client_secret is the "Consumer Secret"
    * instance (e.g., na25) 
3. Ensure docker is running.
4. Run ```docker-compose up```, which will set up several services:
    * nginx with a self-signed certificate and configuration for demo.ldev
    * php7-fpm     
5. Docker-compose will also link your current project directory over into the instance (so you can make live changes) and run composer for you to grab all dependencies.
6. Depending on your local environment, you may need to add a host entry for the domain you wish to
7. After allowing a few minutes for the containers to build and composer to install dependencies, your project should be available at https://demo.ldev or whatever domain you chose to set up. 

## Known Issues
* OAuth login supplied by https://github.com/hwi/HWIOAuthBundle intermittently throws exceptions and needs some more robust handling when clicking the "Log In" button.  Clicking on the "salesforce" link on the resulting exception page will, however, get you logged in.




